<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apparatus Training Plan</title>
    <style>
        :root { --dark-blue: #1a2b3c; --bg: #f4f7f6; --cell: #d9e2ec; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 0; text-align: center; }
        header { background: var(--dark-blue); color: white; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .week-nav { margin: 20px; }
        .week-btn { padding: 10px 15px; margin: 5px; cursor: pointer; background: #2c3e50; color: white; border: none; border-radius: 4px; }
        
        .table-wrapper { overflow-x: auto; padding: 20px; }
        table { width: 100%; border-collapse: separate; border-spacing: 5px; min-width: 1000px; }
        th { color: var(--dark-blue); text-transform: uppercase; font-size: 0.9em; padding: 10px; }
        
        .group-header { background: #eceff1; font-weight: bold; padding: 15px; border-radius: 5px; min-width: 120px; }
        
        .slot { 
            background: var(--cell); border-radius: 5px; padding: 10px; 
            vertical-align: top; text-align: left; font-size: 0.75em; 
            min-height: 100px; transition: 0.2s;
        }
        .slot:hover { background: #bcccdc; }
        .slot.free { background: #eee; color: #999; text-align: center; vertical-align: middle; }
        
        .device-link { 
            display: block; background: rgba(255,255,255,0.5); 
            margin: 3px 0; padding: 4px; border-radius: 3px; 
            text-decoration: none; color: #000; font-weight: 500;
            cursor: pointer; border-left: 3px solid var(--dark-blue);
        }
        .device-link:hover { background: white; }

        /* Modal */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; max-width: 500px; width: 90%; text-align: left; position: relative; }
        .close { position: absolute; top: 10px; right: 20px; font-size: 25px; cursor: pointer; }
        
        @media print { .no-print { display: none; } .modal { display: block; position: relative; } }
    </style>
</head>
<body>

<header class="no-print">
    <h1>APPARATUS TRAINING PLAN</h1>
    <div id="current-week-display">Select a Week</div>
</header>

<div class="week-nav no-print" id="week-btns"></div>

<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>Group</th>
                <th>Monday</th><th>Tuesday</th><th>Wednesday</th><th>Thursday</th><th>Friday</th><th>Saturday</th><th>Sunday</th>
            </tr>
        </thead>
        <tbody id="schedule-body"></tbody>
    </table>
</div>

<div id="planModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div id="modal-body"></div>
        <button class="no-print" onclick="window.print()" style="margin-top:20px; width:100%; padding:10px; cursor:pointer; background: #28a745; color:white; border:none; border-radius:5px;">Print / Save PDF</button>
    </div>
</div>

<script>
    let db = null;
    const groups = ["FIG", "FIG_Rekrutt", "Stiege", "Aspirant"];
    const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

    fetch('data.json').then(r => r.json()).then(data => {
        db = data;
        renderNav();
        loadWeek(db.trainingswochen[0].id);
    });

    function renderNav() {
        const nav = document.getElementById('week-btns');
        db.trainingswochen.forEach(w => {
            const b = document.createElement('button');
            b.className = 'week-btn';
            b.innerText = w.label;
            b.onclick = () => loadWeek(w.id);
            nav.appendChild(b);
        });
    }

    function loadWeek(id) {
        const w = db.trainingswochen.find(x => x.id === id);
        document.getElementById('current-week-display').innerText = w.label;
        const body = document.getElementById('schedule-body');
        body.innerHTML = '';

        groups.forEach(group => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="group-header">${group.replace('_',' ')}</td>`;
            
            days.forEach(day => {
                const td = document.createElement('td');
                const dayData = w.tage[day] ? w.tage[day][group] : null;

                if (dayData) {
                    td.className = 'slot';
                    let html = '';
                    for (let timeDevice in dayData) {
                        html += `<div class="device-link" onclick="openPlan('${id}','${day}','${group}','${timeDevice}')">${timeDevice}</div>`;
                    }
                    td.innerHTML = html;
                } else {
                    td.className = 'slot free';
                    td.innerText = 'FRI';
                }
                tr.appendChild(td);
            });
            body.appendChild(tr);
        });
    }

    function openPlan(wId, day, group, device) {
        const planText = db.trainingswochen.find(x => x.id === wId).tage[day][group][device];
        document.getElementById('modal-body').innerHTML = `
            <small>${group.replace('_',' ')} | ${day}</small>
            <h2>${device}</h2>
            <hr>
            <div style="white-space: pre-wrap; margin-top:15px;">${planText === "..." ? "No detailed plan written yet." : planText}</div>
        `;
        document.getElementById('planModal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('planModal').style.display = 'none'; }
</script>
</body>
</html>
